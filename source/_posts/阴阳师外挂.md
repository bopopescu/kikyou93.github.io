---
title: 阴阳师外挂
tags:
  - Java
  - hobby
categories: 好奇尚异
abbrlink: 63a2eef1
date: 2020-05-10 00:02:10
updated: 2020-05-10 00:02:10
---

咸鱼地有些时日没动博客，最近回坑了下阴阳师，旨在养肝，遂心血来潮写写自动脚本，封号即脱坑，终是闲云野鹤<!--more-->

# 前言
初步功能：自动魂土并点怪，自动结界，自动换结界卡

# 基石
在相应的分辨率下截图，并存入内存中，后续进行比对
```java
        File file = new File(absolutePath + "/images/" + fblpath);
        String[] fileList = file.list();
        for (String fileName : fileList) {
            System.out.println(fileName.substring(0, fileName.lastIndexOf(".")));
            imagesMap.put(fileName.substring(0, fileName.lastIndexOf(".")), getImageFromPath("/images/" + fblpath + "/" + fileName));
        }
```

# 核心
- 使用rgb进行颜色比对，判断图片是否包含，确定图片位置之后进行相对位置的定位
```java
    //查找图片
    private boolean findPic(BufferedImage screenShotImage,
                            BufferedImage targetImage, String buttonName) {
        int[][] screenImageData = getImageGRB(screenShotImage);
        int[][] targetImageData = getImageGRB(targetImage);
        int targetImageHeight = targetImage.getHeight();
        int targetImageWidth = targetImage.getWidth();
        int screenImageHeight = screenShotImage.getHeight();
        int screenImageWidth = screenShotImage.getWidth();

        //先根据上次的位置查找，找不到再遍历查找
        int[] res = position.get(buttonName);
        if (res != null && res.length == 4) {
            boolean isFinded = isMatchAll(res[1], res[0], targetImageHeight, targetImageWidth, screenImageHeight, screenImageWidth, screenImageData, targetImageData);
            if (isFinded) {
                int mouseX = res[0] + getNum(3, targetImageWidth);
                int mouseY = res[1] + getNum(3, targetImageHeight);
                position.put(buttonName, new int[]{res[0], res[1], mouseX, mouseY});
                return true;
            }
        }
        //遍历屏幕截图像素点数据
        for (int y = 0; y < screenImageHeight - targetImageHeight; y++) {
            for (int x = 0; x < screenImageWidth - targetImageWidth; x++) {
                //根据目标图的尺寸，得到目标图四个角映射到屏幕截图上的四个点，
                //判断截图上对应的四个点与图B的四个角像素点的值是否相同，
                //如果相同就将屏幕截图上映射范围内的所有的点与目标图的所有的点进行比较。
                if (isSamePoint(targetImageData[0][0], screenImageData[y][x])
                        && isSamePoint(targetImageData[0][targetImageWidth - 1], screenImageData[y][x + targetImageWidth - 1])
                        && isSamePoint(targetImageData[targetImageHeight - 1][targetImageWidth - 1], screenImageData[y + targetImageHeight - 1][x + targetImageWidth - 1])
                        && isSamePoint(targetImageData[targetImageHeight - 1][0], screenImageData[y + targetImageHeight - 1][x])) {
                    boolean isFinded = isMatchAll(y, x, targetImageHeight, targetImageWidth, screenImageHeight, screenImageWidth, screenImageData, targetImageData);
                    //如果比较结果完全相同，则说明图片找到，填充查找到的位置坐标数据到查找结果数组。
                    if (isFinded) {
                        int mouseX = x + getNum(3, targetImageWidth);
                        int mouseY = y + getNum(3, targetImageHeight);
                        position.put(buttonName, new int[]{x, y, mouseX, mouseY});
                        return true;
                    }
                }
            }
        }
        return false;
    }

```

# 完善
- 目前已增加鬼王之宴、突破功能，择日有空再肝
